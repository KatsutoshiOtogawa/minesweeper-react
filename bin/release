#!/bin/bash

set -e

npm install
npm run dist

SHA=`git rev-parse HEAD`

rm ../minesweeper.github.io/*.js
rm ../minesweeper.github.io/index.html

cp scripts.js ../minesweeper.github.io/${SHA}.js

echo "<!DOCTYPE HTML>
<html lang=\"en\">
  <head>
      <title>Minesweeper</title>
      <meta charset=\"utf-8\">
  </head>
  <body style=\"background-color:#008080;\">
    <div class=\"minesweeper-game\"></div>
    <script src=\"${SHA}\"></script>
  </body>
</html>
" > ../minesweeper.github.io/index.html

echo "# minesweeper react widget

You can either check out this amazing technology by browsing here https://minesweeper.github.io

Or you can embed any number of minesweeper games in your own page by including the following:

\`\`\`html
<div class=\"minesweeper-game\"></div>
<script src=\"${SHA}\"></script>
\`\`\`
" > ../minesweeper.github.io/readme.md

echo A new release is now prepared
echo
echo To deploy:
echo cd ../minesweeper.github.io
echo git add --all
echo git commit -m \"Release ${SHA}\"
echo git push origin master
echo open https://minesweeper.github.io
